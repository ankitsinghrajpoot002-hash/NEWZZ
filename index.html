<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Minimal News — itxankitrajpoot</title>
<style>
  /* Minimal, pixel-clean UI */
  :root{
    --bg:#ffffff;
    --text:#111;
    --muted:#666;
    --accent:#0b5fff;
    --card-bg:#ffffff;
    --radius:8px;
    --shadow: 0 6px 18px rgba(12,18,31,0.06);
    font-family: "Inter", ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
  }
  html,body{height:100%;}
  body{
    margin:0;
    background:var(--bg);
    color:var(--text);
    -webkit-font-smoothing:antialiased;
    -moz-osx-font-smoothing:grayscale;
    display:flex;
    align-items:flex-start;
    justify-content:center;
    padding:28px;
  }

  .container{
    width:100%;
    max-width:980px;
  }

  header{
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:12px;
    margin-bottom:18px;
  }
  .brand{
    display:flex;
    align-items:center;
    gap:12px;
  }
  .logo{
    width:44px;height:44px;
    display:grid;place-items:center;
    font-weight:700;
    border-radius:10px;
    background:#f6f7fb;
    color:var(--accent);
    box-shadow:var(--shadow);
  }
  h1{font-size:18px;margin:0}
  p.lead{margin:0;color:var(--muted);font-size:13px}

  .controls{
    display:flex;gap:8px;align-items:center;
  }
  .btn{
    border-radius:8px;padding:8px 12px;font-size:13px;border:1px solid #e6e9f2;background:white;cursor:pointer;
  }
  .btn.primary{background:var(--accent);color:white;border:0}
  .small{font-size:12px;padding:6px 10px}

  .grid{
    display:grid;
    grid-template-columns: 1fr 340px;
    gap:18px;
  }

  main.card{
    background:var(--card-bg);
    border-radius:var(--radius);
    padding:14px;
    box-shadow:var(--shadow);
    min-height:320px;
  }

  aside.card{
    background:var(--card-bg);
    border-radius:var(--radius);
    padding:14px;
    box-shadow:var(--shadow);
    min-height:320px;
  }

  .meta{
    display:flex;gap:10px;align-items:center;margin-bottom:12px;
  }
  .categories{display:flex;gap:8px;flex-wrap:wrap}
  .chip{border-radius:8px;padding:6px 10px;border:1px solid #eee;font-size:13px;cursor:pointer}
  .chip.active{background:#111;color:white;border:0}

  .articles{display:flex;flex-direction:column;gap:10px}
  .article{
    display:flex;gap:12px;align-items:flex-start;padding:10px;border-radius:10px;border:1px solid #f3f4f7;
  }
  .thumb{
    width:110px;height:72px;background:#f2f4f8;border-radius:8px;flex-shrink:0;overflow:hidden;display:grid;place-items:center;
  }
  .thumb img{width:100%;height:100%;object-fit:cover;display:block}
  .a-body{flex:1}
  .a-title{font-size:15px;margin:0 0 6px 0}
  .a-desc{font-size:13px;color:var(--muted);margin:0}
  .a-meta{font-size:12px;color:var(--muted);margin-top:8px;display:flex;gap:8px;align-items:center}

  .footer-line{display:flex;justify-content:space-between;align-items:center;margin-top:12px;font-size:13px;color:var(--muted)}

  /* Wikipedia card */
  .wiki-title{font-size:14px;margin:0 0 6px 0}
  .wiki-body{font-size:13px;color:var(--muted)}
  .insta{display:inline-block;margin-top:8px;font-size:13px;color:var(--accent);text-decoration:none}

  /* small screens */
  @media (max-width:880px){
    .grid{grid-template-columns: 1fr; }
    aside.card{order:2}
  }
</style>
</head>
<body>
<div class="container">
  <header>
    <div class="brand">
      <div class="logo">ND</div>
      <div>
        <h1>Minimal News</h1>
        <p class="lead">Top headlines • clean • responsive</p>
      </div>
    </div>

    <div class="controls">
      <div id="status" style="font-size:13px;color:var(--muted)">—</div>
      <button id="refreshBtn" class="btn small">Refresh</button>
    </div>
  </header>

  <div class="grid">
    <main class="card" aria-live="polite">
      <div class="meta">
        <div class="categories" id="categoryList">
          <div class="chip active" data-cat="A">A • India Top</div>
          <div class="chip" data-cat="B">B • Defence</div>
          <div class="chip" data-cat="C">C • Geopolitics</div>
        </div>
        <div style="margin-left:auto;color:var(--muted);font-size:13px" id="lastUpdated">—</div>
      </div>

      <div id="articles" class="articles">
        <!-- articles go here -->
      </div>

      <div class="footer-line">
        <div style="color:var(--muted);font-size:13px">Showing top headlines (few). Randomized each refresh.</div>
        <div style="display:flex;gap:8px">
          <a href="https://instagram.com/itxankitrajpoot" target="_blank" rel="noopener" class="insta">@itxankitrajpoot</a>
        </div>
      </div>
    </main>

    <aside class="card">
      <h3 style="margin:0 0 6px 0">Wikipedia — Random</h3>
      <div id="wikiArea">
        <h4 class="wiki-title">Loading…</h4>
        <p class="wiki-body">Please wait while we fetch a short summary from Wikipedia.</p>
      </div>

      <hr style="margin:12px 0;border:none;border-top:1px solid #f1f3f6">

      <div style="font-size:13px;color:var(--muted)">
        <div><strong>Topics included:</strong></div>
        <ul style="padding-left:18px;margin:8px 0;color:var(--muted)">
          <li>India</li>
          <li>Bihar</li>
          <li>APJ Abdul Kalam</li>
          <li>Patna</li>
        </ul>
      </div>

    </aside>
  </div>
</div>

<script>
/*
  Minimal News app
  - Uses NewsData.io 'latest' endpoint (client-side). If CORS blocks it,
    code retries via a public CORS-proxy automatically.
  - Uses Wikipedia REST summary endpoint for compact summaries.
  NOTES:
  - API key is embedded as requested (not recommended for production).
  - Limits articles to `MAX_ARTICLES`.
*/

const NEWS_API_KEY = "pub_67d8142870df4fffa43c4e379883d448"; // your key
const MAX_ARTICLES = 6;
const articlesEl = document.getElementById('articles');
const statusEl = document.getElementById('status');
const lastUpdatedEl = document.getElementById('lastUpdated');
const refreshBtn = document.getElementById('refreshBtn');
const chips = Array.from(document.querySelectorAll('.chip'));

// topics for wikipedia random show
const WIKI_TOPICS = ["India","Bihar","APJ Abdul Kalam","Patna"];

// mapping user categories A/B/C to query parameters
const CATEGORY_MAP = {
  "A": { label: "India Top Headlines", urlParams: { country: "in", language: "en" } },
  "B": { label: "Defence / Military", urlParams: { q: "defence OR defense OR military", language: "en" } },
  "C": { label: "Geopolitics", urlParams: { q: "geopolitic OR geopolitics OR foreign policy OR international relations", language: "en" } }
};

let activeCat = "A";

function setStatus(text, isError = false){
  statusEl.textContent = text;
  statusEl.style.color = isError ? "#b00020" : "var(--muted)";
}

function formatDate(ts){
  const d = new Date(ts);
  return d.toLocaleString(undefined, {hour12:true, year:'numeric', month:'short', day:'numeric', hour:'numeric', minute:'2-digit'});
}

// safe image loader fallback
function createImageOrFallback(src){
  const img = document.createElement('img');
  img.src = src || '';
  img.alt = 'thumb';
  img.loading = 'lazy';
  img.onerror = () => {
    img.style.display = 'none'; // hide broken image
  };
  return img;
}

function clearArticles(){
  articlesEl.innerHTML = '';
}

function showArticles(list){
  clearArticles();
  if(!list || list.length === 0){
    articlesEl.innerHTML = `<div style="color:var(--muted);padding:14px">No news available right now.</div>`;
    return;
  }
  list.forEach(a=>{
    const el = document.createElement('div');
    el.className = 'article';
    const thumb = document.createElement('div');
    thumb.className = 'thumb';
    if(a.image_url){
      const img = createImageOrFallback(a.image_url);
      thumb.appendChild(img);
    } else {
      thumb.innerHTML = '<div style="font-size:11px;color:var(--muted);padding:6px;text-align:center">No image</div>';
    }

    const body = document.createElement('div');
    body.className = 'a-body';
    const title = document.createElement('h3');
    title.className = 'a-title';
    const link = document.createElement('a');
    link.href = a.link || '#';
    link.target = '_blank';
    link.rel = 'noopener';
    link.textContent = a.title || 'Untitled';
    link.style.color = 'var(--text)';
    link.style.textDecoration = 'none';
    title.appendChild(link);

    const desc = document.createElement('p');
    desc.className = 'a-desc';
    desc.textContent = a.description ? (a.description.length > 160 ? a.description.slice(0,160) + '...' : a.description) : (a.content ? a.content.slice(0,150) + '...' : '');

    const meta = document.createElement('div');
    meta.className = 'a-meta';
    const src = document.createElement('span'); src.textContent = (a.source_id || a.source || 'source') ;
    const date = document.createElement('span'); date.textContent = a.pubDate ? formatDate(a.pubDate) : '';
    meta.appendChild(src); meta.appendChild(date);

    body.appendChild(title);
    body.appendChild(desc);
    body.appendChild(meta);

    el.appendChild(thumb);
    el.appendChild(body);
    articlesEl.appendChild(el);
  });
}

// Build NewsData URL
function buildNewsUrl(params){
  const base = 'https://newsdata.io/api/1/latest';
  const u = new URL(base);
  u.searchParams.set('apikey', NEWS_API_KEY);
  // apply all params
  Object.entries(params).forEach(([k,v])=>{
    if(v) u.searchParams.set(k, v);
  });
  // limit to english by default
  if(!u.searchParams.get('language')) u.searchParams.set('language','en');
  return u.toString();
}

// Generic fetch with timeout + CORS-proxy fallback
async function robustFetchJson(url, options = {}, timeoutMs = 8000){
  // try direct fetch first
  try{
    const controller = new AbortController();
    const id = setTimeout(()=>controller.abort(), timeoutMs);
    const res = await fetch(url, {...options, signal: controller.signal});
    clearTimeout(id);
    if(!res.ok) throw new Error('HTTP ' + res.status);
    const j = await res.json();
    return j;
  }catch(err){
    // fallback to public proxy (best-effort)
    // NOTE: public proxy may be rate-limited; if you host this on a server, move the KEY to a server.
    console.warn('Direct fetch failed, trying proxy:', err);
    const proxy = 'https://api.allorigins.win/raw?url=' + encodeURIComponent(url);
    try{
      const controller = new AbortController();
      const id = setTimeout(()=>controller.abort(), timeoutMs);
      const res = await fetch(proxy, {...options, signal: controller.signal});
      clearTimeout(id);
      if(!res.ok) throw new Error('Proxy HTTP ' + res.status);
      const j = await res.json();
      return j;
    }catch(err2){
      console.error('Proxy fetch failed', err2);
      throw err2;
    }
  }
}

async function loadNews(){
  setStatus('Loading news…');
  const cfg = CATEGORY_MAP[activeCat].urlParams;
  const url = buildNewsUrl(cfg);
  try{
    const json = await robustFetchJson(url);
    // NewsData returns results in `results` array or `posts` depending on endpoint
    const hits = json.results || json.posts || [];
    // Normalize each item:
    const items = hits.map(h=>{
      return {
        title: h.title || h.title ?? '',
        description: h.description || h.full_description || '',
        content: h.content || '',
        image_url: h.image_url || h.image || h.enclosure?.url || '',
        link: h.link || h.source_url || h.url || h.guid || '',
        source_id: h.source_id || h.source || (h.source && h.source.name) || '',
        pubDate: h.pubDate ? new Date(h.pubDate).getTime() : (h.pubDate ? Date.parse(h.pubDate) : undefined)
      };
    }).filter(Boolean);

    // pick a random subset limited to MAX_ARTICLES
    shuffleArray(items);
    const pick = items.slice(0, MAX_ARTICLES);
    showArticles(pick);
    const now = Date.now();
    lastUpdatedEl.textContent = 'Last: ' + formatDate(now);
    setStatus('Loaded ' + pick.length + ' articles');
  }catch(err){
    console.error(err);
    setStatus('Failed to load news — showing cached or offline message', true);
    articlesEl.innerHTML = `<div style="padding:14px;color:var(--muted)">Unable to load news automatically. Try Refresh or check your connection. (If you host this online, move the API key to a server to avoid CORS issues.)</div>`;
  }
}

// small helper
function shuffleArray(a){
  for(let i=a.length-1;i>0;i--){
    const j=Math.floor(Math.random()*(i+1));
    [a[i],a[j]]=[a[j],a[i]];
  }
}

// Wikipedia summary fetch
async function loadRandomWiki(){
  const topic = WIKI_TOPICS[Math.floor(Math.random()*WIKI_TOPICS.length)];
  const safeTopic = encodeURIComponent(topic);
  const wikiUrl = `https://en.wikipedia.org/api/rest_v1/page/summary/${safeTopic}`;
  try{
    const res = await fetch(wikiUrl);
    if(!res.ok) throw new Error('WIKI HTTP ' + res.status);
    const j = await res.json();
    const title = j.title || topic;
    const extract = j.extract || 'No summary available.';
    const wikiArea = document.getElementById('wikiArea');
    wikiArea.innerHTML = `
      <h4 class="wiki-title">${escapeHtml(title)}</h4>
      <p class="wiki-body">${escapeHtml(extract)}</p>
      <a href="https://en.wikipedia.org/wiki/${safeTopic}" target="_blank" rel="noopener" style="font-size:13px;color:var(--accent)">Read on Wikipedia ›</a>
    `;
  }catch(err){
    console.error(err);
    const wikiArea = document.getElementById('wikiArea');
    wikiArea.innerHTML = `<h4 class="wiki-title">Wikipedia</h4><p class="wiki-body">Could not fetch Wikipedia summary. Try refresh.</p>`;
  }
}

function escapeHtml(s){
  return String(s).replace(/[&<>"']/g, function(m){ return ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'})[m];});
}

// category click handling
chips.forEach(c=>{
  c.addEventListener('click', ()=>{
    chips.forEach(x=>x.classList.remove('active'));
    c.classList.add('active');
    activeCat = c.dataset.cat;
    loadNews();
  });
});

refreshBtn.addEventListener('click', ()=>{
  loadNews();
  loadRandomWiki();
});

// initial load
setTimeout(()=>{
  setStatus('Ready');
  loadNews();
  loadRandomWiki();
}, 200);

// Helpful note to user in console
console.log("Minimal News running. If you see CORS errors, we automatically retry via allorigins.win proxy.");

/* END */
</script>
</body>
</html>

